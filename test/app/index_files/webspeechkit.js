!function(e){"use strict";void 0===e.ya&&(e.ya={}),void 0===e.ya.speechkit&&(e.ya.speechkit={});var t={websocketProtocol:"wss://",asrUrl:"uniproxy.alice.yandex.net/v2/asrsocket.ws",ttsUrl:"https://tts.voicetech.yandex.net",ttsStreamUrl:"uniproxy.alice.yandex.net/ttssocket.ws",lang:"ru-RU",langWhitelist:["ru-RU","tr-TR","en-US","en-GB","uk-UA","ru","tr","en","uk","en-EN"],model:"notes",applicationName:"jsapi",apikey:"",uuid:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})};window.config&&window.config.FORCE_SKIT_ASR_URL&&(t.asrUrl=window.config.FORCE_SKIT_ASR_URL),window.config&&window.config.FORCE_SKIT_TTS_URL&&(t.ttsStreamUrl=window.config.FORCE_SKIT_TTS_URL),void 0===e.ya.speechkit._extend?e.ya.speechkit.settings=t:e.ya.speechkit.settings=e.ya.speechkit._extend(t,e.ya.speechkit.settings)}(this),function(o){"use strict";var e;void 0===o.ya&&(o.ya={}),void 0===o.ya.speechkit&&(o.ya.speechkit={}),o.ya.speechkit.AudioContext=window.AudioContext||window.webkitAudioContext||null,o.ya.speechkit.FORMAT={PCM8:{format:"pcm",sampleRate:8e3,mime:"audio/x-pcm;bit=16;rate=8000",bufferSize:1024},PCM16:{format:"pcm",sampleRate:16e3,mime:"audio/x-pcm;bit=16;rate=16000",bufferSize:2048},PCM44:{format:"pcm",sampleRate:44100,mime:"audio/x-pcm;bit=16;rate=44100",bufferSize:4096}},"undefined"!=typeof MediaRecorder&&((e=MediaRecorder.isTypeSupported||MediaRecorder.isMimeTypeSupported||MediaRecorder.canRecordMimeType||function(e){return!1})("audio/ogg; codecs=opus")?o.ya.speechkit.FORMAT.OPUS={format:"opus",sampleRate:48e3,mime:"audio/ogg;codecs=opus",bufferSize:512}:e("audio/webm; codecs=opus")&&(o.ya.speechkit.FORMAT.OPUS={format:"opus",sampleRate:48e3,mime:"audio/webm;codecs=opus",bufferSize:512})),o.ya.speechkit._stream=null,o.ya.speechkit._extend=function(e,t){var i,s=Object.prototype.toString;for(i in e=e||{},t)t.hasOwnProperty(i)&&("object"==typeof t[i]?(e[i]="[object Array]"===s.call(t[i])?[]:{},o.ya.speechkit._extend(e[i],t[i])):void 0===t[i]&&void 0!==e[i]||(e[i]=t[i]));return e},o.ya.speechkit.isChrome=[].some.call(navigator.plugins||[],function(e){return"Chrome PDF Viewer"===e.name}),o.ya.speechkit.isChromium=/chrome/.test(navigator.userAgent.toLowerCase())&&!o.ya.speechkit.isChrome;function t(){return o.ya.speechkit._stream?this instanceof t?(this.worker=o.ya.speechkit.newWorker(),this.recording=!1,this.paused=!1,this.lastDataOnPause=0,this.nullsArray=[],this.currCallback=null,this.buffCallback=null,this.startCallback=null,this.audioInput=null,this.mediaRecorder=null,void(this.worker.onmessage=function(e){var t;"int16stream"==e.data.command?(t=e.data.buffer,this.startCallback&&this.startCallback(t)):"getBuffers"==e.data.command&&this.buffCallback?this.buffCallback(e.data.blob):"clear"==e.data.command&&this.currCallback?this.currCallback():this.currCallback&&this.currCallback(e.data.blob)}.bind(this))):new t:null}t.prototype={_createNode:function(e){o.ya.speechkit.audiocontext||(o.ya.speechkit.audiocontext=new o.ya.speechkit.AudioContext),this.audioInput=o.ya.speechkit.audiocontext.createMediaStreamSource(o.ya.speechkit._stream),"pcm"==e.format?(o.ya.speechkit.audiocontext.createScriptProcessor?this.node=o.ya.speechkit.audiocontext.createScriptProcessor(e.bufferSize,2,2):this.node=o.ya.speechkit.audiocontext.createJavaScriptNode(e.bufferSize,2,2),this.audioInput.connect(this.node),this.node.onaudioprocess=function(e){this.recording&&(this.paused?2e3<Number(new Date)-this.lastDataOnPause&&(this.lastDataOnPause=Number(new Date),this.worker.postMessage({command:"record",buffer:[this.nullsArray,this.nullsArray]})):this.worker.postMessage({command:"record",buffer:[e.inputBuffer.getChannelData(0),e.inputBuffer.getChannelData(1)]}))}.bind(this),this.node.connect(o.ya.speechkit.audiocontext.destination)):"opus"==e.format&&"undefined"!=typeof MediaRecorder&&(this.mediaRecorder=new MediaRecorder(o.ya.speechkit._stream,{mimeType:e.mime}))},pause:function(){this.paused=!0,this.lastDataOnPause=Number(new Date),this.mediaRecorder&&this.mediaRecorder.pause()},getAudioContext:function(){return o.ya.speechkit.audiocontext},getAnalyserNode:function(){o.ya.speechkit.audiocontext||(o.ya.speechkit.audiocontext=new o.ya.speechkit.AudioContext);var e=o.ya.speechkit.audiocontext.createAnalyser();return e.fftSize=2048,this.audioInput||(this.audioInput=o.ya.speechkit.audiocontext.createMediaStreamSource(o.ya.speechkit._stream)),this.audioInput.connect(e),e},isPaused:function(){return this.paused},start:function(e,t){var i,s=this;if(!o.ya.speechkit._stream)return o.ya.speechkit.initRecorder(function(){s.start(e,t)},console.log);if((this.node||t&&"pcm"!=t.format)&&(this.mediaRecorder||!t||"opus"!=t.format)||this._createNode(t),this.isPaused())return this.paused=!1,void(this.mediaRecorder&&this.mediaRecorder.resume());if(this.startCallback=void 0!==e?e:null,t&&"pcm"!=t.format)t&&"opus"==t.format&&this.mediaRecorder&&(i=function(e){var t,i;this.startCallback&&(t=this.startCallback,(i=new FileReader).onload=function(){0<this.result.byteLength&&t(this.result)},i.readAsArrayBuffer(e.data))}.bind(this),this.mediaRecorder.ondataavailable=i,this.mediaRecorder.start(200));else{this.worker.postMessage({command:"init",config:{sampleRate:o.ya.speechkit.audiocontext.sampleRate,format:t||o.ya.speechkit.FORMAT.PCM16,channels:this.channelCount}}),this.nullsArray=[];for(var n=(t||o.ya.speechkit.FORMAT.PCM16).bufferSize,r=0;r<n;r++)this.nullsArray.push(0)}this.clear(function(){this.recording=!0}.bind(this))},stop:function(t,e){this.recording=!1,this.node&&this.node.disconnect(),this.node=null,this.mediaRecorder&&this.mediaRecorder.stop(),this.mediaRecorder=null,o.ya.speechkit.stopRecorder(),void 0!==t&&this.exportWav(function(e){t(e)},e||2)},isRecording:function(){return this.recording},clear:function(e){this.currCallback=void 0!==e?e:null,this.worker.postMessage({command:"clear"})},getBuffers:function(e){this.buffCallback=void 0!==e?e:null,this.worker.postMessage({command:"getBuffers"})},exportWav:function(e,t){this.currCallback=void 0!==e?e:null;if(!this.currCallback)throw new Error("Callback not set");this.worker.postMessage({command:"export"+(2!=t?"Mono":"")+"WAV",type:"audio/wav"})}},o.ya.speechkit.Recorder=t,o.ya.speechkit.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.webkitGetUserMedia,o.ya.speechkit.mediaDevices=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices:o.ya.speechkit.getUserMedia?{getUserMedia:function(i){return new Promise(function(e,t){o.ya.speechkit.getUserMedia.call(navigator,i,e,t)})}}:null,o.ya.speechkit._stream=null,o.ya.speechkit.audiocontext=null,o.ya.speechkit.initRecorder=function(t,i){function s(e){o.ya.speechkit._stream=null,void 0!==i&&i(e)}o.ya.speechkit.mediaDevices?o.ya.speechkit.mediaDevices.getUserMedia({audio:!0}).then(function(e){o.ya.speechkit._stream=e,void 0!==t&&t()}).catch(function(e){s(e.message||e.name||e)}):s("Your browser doesn't support Web Audio API. Please, use Yandex.Browser: https://browser.yandex.ru")},o.ya.speechkit.stopRecorder=function(){o.ya.speechkit._stream&&o.ya.speechkit._stream.getAudioTracks?o.ya.speechkit._stream.getAudioTracks()[0].stop():o.ya.speechkit._stream&&void 0!==o.ya.speechkit._stream.stop&&o.ya.speechkit._stream.stop(),o.ya.speechkit._stream=null,void 0!==o.ya.speechkit.audiocontext&&null!==o.ya.speechkit.audiocontext&&void 0!==o.ya.speechkit.audiocontext.close&&(o.ya.speechkit.audiocontext.close(),o.ya.speechkit.audiocontext=null)},o.ya.speechkit.isPermissionProvided=function(){return null!=o.ya.speechkit._stream},o.ya.speechkit.isLanguageSupported=function(e){return 0<=o.ya.speechkit.settings.langWhitelist.indexOf(e)?o.ya.speechkit.isSupported():o.ya.speechkit.isWebAudioSupported()},o.ya.speechkit.isSupported=function(){return null!==this.mediaDevices&&null!==this.AudioContext},o.ya.speechkit.isWebAudioSupported=function(){var e=navigator.userAgent.toLowerCase();return void 0!==(o.SpeechRecognition||o.webkitSpeechRecognition)&&!/yabrowser|opera|opr/.test(e)&&!o.ya.speechkit.isChromium}}(this),function(e){"use strict";void 0===e.ya&&(e.ya={}),void 0===e.ya.speechkit&&(e.ya.speechkit={});e.ya.speechkit.newWorker=function(){return e="function iirFilter (sampleRate, cutoff, resonance, type) {    var\tself\t= this,            f\t= [0.0, 0.0, 0.0, 0.0],            freq, damp,            prevCut, prevReso,            sin\t= Math.sin,            min\t= Math.min,            pow\t= Math.pow;    self.cutoff = cutoff || 20000;    self.resonance = resonance || 0.1;    self.samplerate = sampleRate || 44100;    self.type = type || 0;    function calcCoeff () {            freq = 2 * sin(Math.PI * min(0.25, self.cutoff / (self.samplerate * 2)));            damp = min(2 * (1 - pow(self.resonance, 0.25)), min(2, 2 / freq - freq * 0.5));    }    self.pushSample = function (sample) {            if (prevCut !== self.cutoff || prevReso !== self.resonance){                    calcCoeff();                    prevCut = self.cutoff;                    prevReso = self.resonance;            }            f[3] = sample - damp * f[2];            f[0] = f[0] + freq * f[2];            f[1] = f[3] - f[0];            f[2] = freq * f[1] + f[2];            f[3] = sample - damp * f[2];            f[0] = f[0] + freq * f[2];            f[1] = f[3] - f[0];            f[2] = freq * f[1] + f[2];            return f[self.type];    };    self.getMix = function (type) {            return f[type || self.type];    };}var speex_loaded = false;var recLength = 0;var recBuffersL = [];var recBuffersR = [];var sampleRate;var outSampleRate;var tmp_buf = 0;var need_buf_size = 4096;var speex_converter = null;    this.onmessage = function (e) {    switch (e.data.command) {    case 'init':        init(e.data.config);        break;    case 'record':        record(e.data.buffer);        break;    case 'exportWAV':        exportWAV(e.data.type);        break;    case 'exportMonoWAV':        exportMonoWAV(e.data.type);        break;    case 'getBuffers':        getBuffers();        break;    case 'clear':        clear();        break;    }};    function init(config) {    sampleRate = config.sampleRate;    outSampleRate = config.format.sampleRate || sampleRate;    need_buf_size = config.format.bufferSize || 4096;    speex_converter = null;    /*if (config.format.format == 'speex') {        if (!speex_loaded) {            importScripts('./speex.min.js');            speex_loaded = true;        }        need_buf_size /= 16;        speex_converter = new SpeexConverter(outSampleRate);    }*/}var resample = function (inbuf) {    var speed = 1.0 * sampleRate / outSampleRate;    var l = Math.ceil(inbuf.length / speed);    var result = new Float32Array(l);    var bin = 0;    var num = 0;    var indexIn = 0;    var indexOut = 0;    for (indexOut = 1, indexIn = speed; indexOut < l - 1; indexIn += speed, indexOut++) {        var pos = Math.floor(indexIn);        var dt = indexIn - pos;        var second = (pos + 1 < inbuf.length) ? pos + 1 : inbuf.length - 1;         result[indexOut] = inbuf[pos] * (1 - dt) + inbuf[second] * dt;    }    result[0] = inbuf[0];    result[l - 1] = inbuf[inbuf.length - 1];    return result;};    function record(inputBuffer) {    if (outSampleRate == sampleRate) {        recBuffersL.push(inputBuffer[0]);        recBuffersR.push(inputBuffer[1]);        recLength += inputBuffer[0].length;            var samples = inputBuffer[0];        var buffer = new ArrayBuffer(samples.length * 2);        var view = new DataView(buffer);        floatTo16BitPCM(view, 0, samples);        this.postMessage({command: 'int16stream', buffer: buffer});    } else {        var filter0 = new iirFilter(outSampleRate, outSampleRate * 0.125, 0.0);         var filter1 = new iirFilter(outSampleRate, outSampleRate * 0.125, 0.0);         for (var i =0; i < inputBuffer[0].length; i++) {             inputBuffer[0][i] = filter0.pushSample(inputBuffer[0][i]);             inputBuffer[1][i] = filter1.pushSample(inputBuffer[1][i]);         }        var resin0 = resample(inputBuffer[0], outSampleRate, sampleRate);        var resin1 = resample(inputBuffer[1], outSampleRate, sampleRate);            recBuffersL.push(resin0);        recBuffersR.push(resin1);        recLength += resin0.length;            var result = new Int16Array(resin0.length);            for (var i = 0 ; i < resin0.length ; i++) {            result[i] = Math.floor(Math.min(Math.max((resin0[i] + resin1[i]) * 0.5, -1.0), 1.0) * 16383);        }            if (speex_converter) {            result = speex_converter.convert(result);        } else {            result = result.buffer;        }            if (!tmp_buf) {            tmp_buf = result;        } else {            var tmp = new DataView(new ArrayBuffer(tmp_buf.byteLength + result.byteLength));            tmp_buf = new DataView(tmp_buf);            result = new DataView(result);                for (i = 0; i < tmp_buf.byteLength; i++) {                tmp.setUint8(i, tmp_buf.getUint8(i));            }                for (i = 0; i < result.byteLength; i++) {                tmp.setUint8(i + tmp_buf.byteLength, result.getUint8(i));            }                tmp_buf = tmp.buffer;        }            if (tmp_buf.byteLength >= need_buf_size) {            this.postMessage({command: 'int16stream', buffer: tmp_buf});            tmp_buf = false;        }    }}    function exportWAV(type) {    var bufferL = mergeBuffers(recBuffersL, recLength);    var bufferR = mergeBuffers(recBuffersR, recLength);    var interleaved = interleave(bufferL, bufferR);    var dataview = encodeWAV(interleaved);    var audioBlob = new Blob([dataview], {type: type});        this.postMessage({command: 'exportWAV', blob: audioBlob});}    function exportMonoWAV(type) {    var bufferL = mergeBuffers(recBuffersL, recLength);    var dataview = encodeWAV(bufferL, true);    var audioBlob = new Blob([dataview], {type: type});        this.postMessage({command: 'exportMonoWAV', blob: audioBlob});}    function getBuffers() {    var buffers = [];    buffers.push(mergeBuffers(recBuffersL, recLength));    buffers.push(mergeBuffers(recBuffersR, recLength));    this.postMessage({command: 'getBuffers', blob: buffers});}    function clear() {    recLength = 0;    recBuffersL = [];    recBuffersR = [];    if (speex_converter) {        speex_converter.clear();    }    this.postMessage({command: 'clear'});}    function mergeBuffers(recBuffers, recLength) {    var result = new Float32Array(recLength);    var offset = 0;    for (var i = 0; i < recBuffers.length; i++){        result.set(recBuffers[i], offset);        offset += recBuffers[i].length;    }    return result;}    function interleave(inputL, inputR) {    var length = inputL.length + inputR.length;    var result = new Float32Array(length);        var index = 0;    var inputIndex = 0;        while (index < length){        result[index++] = inputL[inputIndex];        result[index++] = inputR[inputIndex];        inputIndex++;    }    return result;}    function floatTo16BitPCM(output, offset, input) {    for (var i = 0; i < input.length; i++, offset += 2){        var s = Math.max(-1, Math.min(1, input[i]));        output.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7FFF, true);    }}    function writeString(view, offset, string) {    for (var i = 0; i < string.length; i++){        view.setUint8(offset + i, string.charCodeAt(i));    }}    function encodeWAV(samples, mono) {    var buffer = new ArrayBuffer(44 + samples.length * 2);    var view = new DataView(buffer);        /* RIFF identifier */    writeString(view, 0, 'RIFF');    /* file length */    view.setUint32(4, 32 + samples.length * 2, true);    /* RIFF type */    writeString(view, 8, 'WAVE');    /* format chunk identifier */    writeString(view, 12, 'fmt ');    /* format chunk length */    view.setUint32(16, 16, true);    /* sample format (raw) */    view.setUint16(20, 1, true);    /* channel count */    view.setUint16(22, mono ? 1 : 2, true);    /* sample rate */    view.setUint32(24, outSampleRate, true);    /* block align (channel count * bytes per sample) */    var block_align = mono ? 2 : 4;    /* byte rate (sample rate * block align) */    view.setUint32(28, outSampleRate * block_align, true);    /* block align (channel count * bytes per sample) */    view.setUint16(32, block_align, true);    /* bits per sample */    view.setUint16(34, 16, true);    /* data chunk identifier */    writeString(view, 36, 'data');    /* data chunk length */    view.setUint32(40, samples.length * 2, true);        floatTo16BitPCM(view, 44, samples);        return view;} ",t=window.URL||window.webkitURL,i=window.Blob,s=window.Worker,t&&i&&s&&e?(e=new i([e],{type:"application/javascript"}),new s(t.createObjectURL(e))):null;var e,t,i,s}}(this),function(t){"use strict";void 0===t.ya&&(t.ya={}),void 0===t.ya.speechkit&&(t.ya.speechkit={});function e(e){if(!(this instanceof t.ya.speechkit.Recognizer))return new t.ya.speechkit.Recognizer(e);this.options=t.ya.speechkit._extend({apikey:t.ya.speechkit.settings.apikey,uuid:t.ya.speechkit.settings.uuid,url:t.ya.speechkit.settings.websocketProtocol+t.ya.speechkit.settings.asrUrl,onInit:function(){},onResult:function(){},onError:function(){},punctuation:!0,allowStrongLanguage:!1},e),this.options.key=this.options.apikey,this.options.format=this.options.format.mime,this.sessionId=null,this.socket=null,this.onFinish=function(){},this.buffered=[],this.totaldata=0,this._expectClosing=!1}e.prototype={_sendRaw:function(e){if(this.socket)try{this.socket.send(e)}catch(e){this.options.onError("Socket error: "+e)}},_sendJson:function(e){this._sendRaw(JSON.stringify({type:"message",data:e}))},start:function(){this.sessionId=null;try{this.socket=new WebSocket(this.options.url)}catch(e){return this.options.onError("Error on socket creation: "+e),void this.options.stopCallback()}this.socket.onopen=function(){this._sendJson(this.options)}.bind(this),this.socket.onmessage=function(e){try{var t=JSON.parse(e.data)}catch(e){return this.options.onError("Error on receiving data from server: "+e),void this.options.stopCallback()}"InitResponse"==t.type?(this.sessionId=t.data.sessionId,this.options.onInit(t.data.sessionId,t.data.code)):"AddDataResponse"==t.type?(this.options.onResult(t.data.text,t.data.uttr,t.data.merge,t.data.words,t.data.biometry,t.data.metainfo),void 0!==t.data.close&&t.data.close&&this.close()):("Error"==t.type?this.options.onError("Session "+this.sessionId+": "+t.data):this.options.onError("Session "+this.sessionId+": "+t),this.close())}.bind(this),this.socket.onerror=function(e){this.options.onError("Socket error: "+e.message)}.bind(this),this.socket.onclose=function(e){this._expectClosing?this._expectClosing=!1:this.options.onUnexpectedClose()}.bind(this)},addData:function(e){if(this.totaldata+=e.byteLength,this.sessionId){for(var t=0;t<this.buffered.length;t++)this._sendRaw(new Blob([this.buffered[t]],{type:this.options.format})),this.totaldata+=this.buffered[t].byteLength;this.buffered=[],this._sendRaw(new Blob([e],{type:this.options.format}))}else this.buffered.push(e)},finish:function(e){this.onFinish=e,this._sendJson({command:"finish"})},close:function(){this.options.onInit=function(){},this.options.onResult=this.options.onInit,this.options.onError=this.options.onInit,this.onFinish(),this.socket&&(this._expectClosing=!0,this.socket.close(),this.options.stopCallback()),this.socket=null}},t.ya.speechkit.Recognizer=e}(this),function(i){"use strict";function e(){}void 0===i.ya&&(i.ya={}),void 0===i.ya.speechkit&&(i.ya.speechkit={}),i.ya.speechkit._defaultOptions=function(){return{initCallback:e,errorCallback:e,dataCallback:e,infoCallback:e,stopCallback:e,punctuation:!1,allowStrongLanguage:!1,model:i.ya.speechkit.settings.model,applicationName:window.location.href,device:navigator.userAgent,lang:i.ya.speechkit.settings.lang,format:i.ya.speechkit.FORMAT.PCM16,url:i.ya.speechkit.settings.websocketProtocol+i.ya.speechkit.settings.asrUrl,vad:!1,useWebAudioRecognition:!1,speechStart:e,speechEnd:e}};function t(){if(!(this instanceof i.ya.speechkit.SpeechRecognition))return new i.ya.speechkit.SpeechRecognition;this.send=0,this.send_bytes=0,this.proc=0,this.recorder=null,this.recognizer=null,this.vad=null}t.prototype={start:function(e){var t;this.options=i.ya.speechkit._extend(i.ya.speechkit._extend({},i.ya.speechkit._defaultOptions()),e),this.options.useWebAudioRecognition&&i.ya.speechkit.isWebAudioSupported()||!(0<=i.ya.speechkit.settings.langWhitelist.indexOf(this.options.lang))?(t=this.options.errorCallback,this.recorder=i.ya.speechkit.WebAudioRecognition(i.ya.speechkit._extend(this.options,{errorCallback:function(e){this.recorder=null,t(e)}.bind(this)})),this.recorder.start()):null!==i.ya.speechkit._stream?this._onstart():i.ya.speechkit.initRecorder(this._onstart.bind(this),this.options.errorCallback)},_onstart:function(){this.recorder&&this.recorder.isPaused()&&this.recorder.start(),this.recognizer||(this.send=0,this.send_bytes=0,this.proc=0,this.recorder||(this.recorder=new i.ya.speechkit.Recorder,this.options.vad&&(this.vad=new i.ya.speechkit.Vad({recorder:this.recorder,speechStart:this.options.speechStart,speechEnd:this.options.speechEnd}))),this.recognizer=new i.ya.speechkit.Recognizer(i.ya.speechkit._extend(this.options,{onInit:function(e,t){if(200!=t)return this.options.errorCallback("Session initialization failed. Response code "+t),void this.abort();this.recorder.start(function(e){this.options.vad&&this.vad&&this.vad.update(),this.send++,this.send_bytes+=e.byteLength,this.options.infoCallback({send_bytes:this.send_bytes,format:this.options.format,send_packages:this.send,processed:this.proc}),this.recognizer&&this.recognizer.addData(e)}.bind(this),this.options.format),this.options.initCallback(e,t,"yandex")}.bind(this),onResult:function(e,t,i,s,n,r){this.proc+=i,this.options.infoCallback({send_bytes:this.send_bytes,format:this.options.format,send_packages:this.send,processed:this.proc}),this.options.dataCallback(e,t,i,s,n,r),clearTimeout(this.timeout),t&&(this.timeout=setTimeout(this.abort,5e3))}.bind(this),onError:function(e){this.recorder&&this.recorder.stop(function(){this.recorder=null}.bind(this)),this.recognizer&&(this.recognizer.close(),this.recognizer=null),this.options.errorCallback(e)}.bind(this),onUnexpectedClose:function(){this.recorder&&this.recorder.stop(function(){this.recorder=null}.bind(this)),this.recognizer&&(this.recognizer.close(),this.recognizer=null)}.bind(this)})),this.recognizer.start())},stop:function(){this.recognizer&&this.recognizer.finish(function(){this.recorder&&this.recorder.stop(function(){this.recorder=null,this.recognizer=null}.bind(this))}.bind(this)),!this.recognizer&&this.recorder&&this.recorder.stop(function(){this.recorder=null,this.recognizer=null}.bind(this))},abort:function(){this.recognizer&&this.recognizer.close(),this.recorder&&this.recorder.stop(function(){this.recognizer=null,this.recorder=null}.bind(this))},pause:function(){this.recorder&&this.recorder.pause()},isPaused:function(){return!this.recorder||this.recorder.isPaused()}},ya.speechkit.SpeechRecognition=t,i.ya.speechkit.recognize=function(e){var s=new i.ya.speechkit.SpeechRecognition,n=i.ya.speechkit._extend(i.ya.speechkit._extend({},i.ya.speechkit._defaultOptions()),e);n.doneCallback=e.doneCallback,n.dataCallback=function(e,t,i){t&&(n.doneCallback&&n.doneCallback(e),s.stop())},n.stopCallback=function(){s=null},s.start(n)}}(this),function(t){"use strict";void 0===t.ya&&(t.ya={}),void 0===t.ya.speechkit&&(t.ya.speechkit={});function e(e){if(!(this instanceof t.ya.speechkit.WebAudioRecognition))return new t.ya.speechkit.WebAudioRecognition(e);this.recognition=null,this.recorder=null,this.options=t.ya.speechkit._extend(t.ya.speechkit._extend(t.ya.speechkit._defaultOptions(),e),{format:t.ya.speechkit.FORMAT.PCM44})}e.prototype={_onstart:function(){this.send=0,this.send_bytes=0,this.recognition=t.ya.speechkit._extend(this.recognition,{interim_transcript:"",lang:this.options.lang,onend:this.stop.bind(this),onresult:function(e){this.interim_transcript="";for(var t=[],i=e.resultIndex;i<e.results.length;++i)e.results[i].isFinal?(t.push({0:{transcript:e.results[i][0].transcript,confidence:e.results[i][0].confidence}}),this.backref.options.dataCallback(e.results[i][0].transcript,!0,1),this.interim_transcript=""):this.interim_transcript+=e.results[i][0].transcript;this.backref.options.dataCallback(this.interim_transcript,!1,1)},continuous:!0,interimResults:!0,maxAlternatives:5,errorCallback:this.options.errorCallback,onerror:function(e){this.errorCallback(e.error)}}),(this.recognition.backref=this).recorder=null,this.recognizer=null,this.recognition.onstart=this.options.initCallback.bind(this,"",200,"native"),this.recognition.start()},start:function(){void 0!==t.webkitSpeechRecognition?(this.recognition=new t.webkitSpeechRecognition,null!==t.ya.speechkit._stream?this._onstart():t.ya.speechkit.initRecorder(this._onstart.bind(this),this.options.errorCallback)):this.options.errorCallback("Your browser doesn't implement Web Speech API")},stop:function(e){this.recognition&&(this.recognition.onend=function(){},this.recognition.stop()),t.ya.speechkit.stopRecorder(),this.options.stopCallback(),void 0!==e&&"[object Function]"==Object.prototype.toString.call(e)&&e()},pause:function(){},isPaused:function(){return!1},getAnalyserNode:function(){return t.ya.speechkit.Recorder.prototype.getAnalyserNode.call(this)}},t.ya.speechkit.WebAudioRecognition=e}(this);